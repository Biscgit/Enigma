unit-integration-test:
  stage: test
  image: registry.mygit.th-deg.de/ts19084/enigma/python-tester-linter:latest
  before_script:
    - cd backend
  script:
    - python3 -m pytest --cov=./ --cov-report=xml --junitxml=report.xml
  after_script:
      - xmllint --format backend/report.xml
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    reports:
      junit: backend/report.xml
      coverage_report:
        coverage_format: cobertura
        path: backend/coverage.xml
  rules:
     - exists:
       - backend/server/test/*
  needs:
    - lint-backend

e2e-test:
  stage: e2e-test
  image: registry.mygit.th-deg.de/ts19084/enigma/flutter-builder:latest
  before_script:
    - cd frontend
    - flutter pub get
  script:
    - flutter test --file-reporter "json:result.json"
  artifacts:
    paths: 
      - frontend/result.json
  rules:
    - exists:
        - frontend/test/*
  needs:
    - build-frontend
    - build-backend
